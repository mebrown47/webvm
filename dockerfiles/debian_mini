FROM --platform=linux/386 i386/debian:bookworm-slim
ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates wget curl gnupg lsb-release \
    python3 python3-pip python3-numpy python3-scipy python3-matplotlib python3-pyrtlsdr \
    rtl-sdr librtlsdr-dev sox \
    nodejs npm \
  && rm -rf /var/lib/apt/lists/*

# Create user, copy package.json, run npm ci, etc.
RUN useradd -m user
WORKDIR /home/user
COPY package.json package-lock.json* ./
RUN npm ci --no-audit --no-fund
COPY . .
RUN npm run build
CMD ["/bin/bash"]
